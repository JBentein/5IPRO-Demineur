<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Démineur</title>
  <style>
    table {
      border-collapse: collapse;
    }
    td {
      width: 30px;
      height: 30px;
      text-align: center;
      font-weight: bold;
      border: 1px solid black;
    }
  </style>
</head>
<body>
  <table id="game-board"></table>
  <script>
    // Définit les constantes de jeu pour le démineur
    const ROWS = 10; // nombre de lignes du démineur
    const COLS = 10; // nombre de colonnes
    const MINES = 15; // nombre de mines

    // Initialise le tableau de jeu avec des zéros
    let board = []; // tableau de jeu
    for (let i = 0; i < ROWS; i++) {
      board[i] = [];
      for (let j = 0; j < COLS; j++) {
        board[i][j] = 0;
      }
    }

    // Place les mines dans le tableau de jeu
    let minesPlaced = 0;
    while (minesPlaced < MINES) {
      let row = Math.floor(Math.random() * ROWS);
      let col = Math.floor(Math.random() * COLS);
      if (board[row][col] === 0) {
        board[row][col] = 'M';
        minesPlaced++;
      }
    }

    // Calcule les valeurs de chaque case
    for (let i = 0; i < ROWS; i++) {
      for (let j = 0; j < COLS; j++) {
        if (board[i][j] !== 'M') {
          let count = 0;
          if (i > 0 && j > 0 && board[i - 1][j - 1] === 'M') count++;
          if (i > 0 && board[i - 1][j] === 'M') count++;
          if (i > 0 && j < COLS - 1 && board[i - 1][j + 1] === 'M') count++;
          if (j > 0 && board[i][j - 1] === 'M') count++;
          if (j < COLS - 1 && board[i][j + 1] === 'M') count++;
          if (i < ROWS - 1 && j > 0 && board[i + 1][j - 1] === 'M') count++;
          if (i < ROWS - 1 && board[i + 1][j] === 'M') count++;
          if (i < ROWS - 1 && j < COLS - 1 && board[i + 1][j + 1] === 'M') count++;
          board[i][j] = count;
        }
      }
    }

    // Fonction pour gérer le clic sur une case
    function handleClick(event) {
      let row = parseInt(event.target.getAttribute('data-row'));
      let col = parseInt(event.target.getAttribute('data-col'));
      let cell = event.target;

      // Ignore le clic si la case a déjà été révélée ou marquée
      if (cell.classList.contains('revealed') || cell.classList.contains('flagged')) {
        return;
      }

      
        // Révèle la case cliquée
      cell.classList.add('revealed');
      if (board[row][col] === 'M') {
        // La case est une mine, fin du jeu
        cell.textContent = 'X';
        alert('Vous avez perdu !');
      } else if (board[row][col] === 0) {
        // La case est vide, révèle les cases adjacentes
        revealAdjacentCells(row, col);
      } else {
        // La case contient un nombre, affiche le nombre
        cell.textContent = board[row][col];
      }
    }

    // Fonction pour révéler les cases adjacentes à une case vide
    function revealAdjacentCells(row, col) {
      if (row < 0 || row >= ROWS || col < 0 || col >= COLS) {
        // La case est en dehors des limites du tableau, fin de la récursion
        return;
      }
      let cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell.classList.contains('revealed') || cell.classList.contains('flagged')) {
        // La case a déjà été révélée ou marquée, fin de la récursion
        return;
      }
      cell.classList.add('revealed');
      if (board[row][col] === 0) {
        // La case est vide, continue de révéler les cases adjacentes
        revealAdjacentCells(row - 1, col - 1);
        revealAdjacentCells(row - 1, col);
        revealAdjacentCells(row - 1, col + 1);
        revealAdjacentCells(row, col - 1);
        revealAdjacentCells(row, col + 1);
        revealAdjacentCells(row + 1, col - 1);
        revealAdjacentCells(row + 1, col);
        revealAdjacentCells(row + 1, col + 1);
      } else {
        // La case contient un nombre, affiche le nombre
        cell.textContent = board[row][col];
      }
    }

    // Dessine le tableau de jeu dans la page HTML
    let table = document.getElementById('game-board');
    for (let i = 0; i < ROWS; i++) {
      let row = document.createElement('tr');
      for (let j = 0; j < COLS; j++) {
        let cell = document.createElement('td');
        cell.setAttribute('data-row', i);
        cell.setAttribute('data-col', j);
        cell.addEventListener('click', handleClick);
        row.appendChild(cell);
      }
      table.appendChild(row);
    }
  </script>
</body>
</html>
